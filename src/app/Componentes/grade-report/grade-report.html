<div class="container my-4">
  <h2 class="mb-3">Reporte de Notas</h2>

  <div class="row g-3 align-items-end">
    <div class="col-md-3">
      <label class="form-label">Curso (código)</label>
      <input class="form-control" [(ngModel)]="curso" name="curso" placeholder="FS, IA, etc"/>
    </div>
    <div class="col-md-3">
      <label class="form-label">Sección (nombre opcional)</label>
      <input class="form-control" [(ngModel)]="seccionNombre" name="seccionNombre" placeholder="A, B, 2024-1"/>
    </div>
    <div class="col-md-3">
      <label class="form-label">Código estudiante</label>
      <input class="form-control" [(ngModel)]="codigo" name="codigo" placeholder="U12345678"/>
    </div>
    <div class="col-md-3">
      <button class="btn btn-primary w-100" (click)="buscar()" [disabled]="loading">Filtrar</button>
    </div>
  </div>

  <div class="mt-3 d-flex gap-2">
    <button class="btn btn-outline-secondary" (click)="exportar('csv')" [disabled]="loading">Exportar CSV</button>
    <button class="btn btn-outline-secondary" (click)="exportar('xlsx')" [disabled]="loading">Exportar XLSX</button>
    <button class="btn btn-outline-secondary" (click)="exportar('pdf')" [disabled]="loading">Exportar PDF</button>
  </div>

  <div class="mt-3">
    <button class="btn btn-info me-2" (click)="runProyeccion()" [disabled]="!canRunML || loading">ML: Proyección</button>
    <button class="btn btn-warning" (click)="runRiesgo()" [disabled]="!canRunML || loading">ML: Riesgo</button>
    <div class="mt-2 text-muted">{{ mlMsg }}</div>
  </div>

  <div class="table-responsive mt-3" *ngIf="filas.length; else noRows">
    <table class="table table-bordered table-striped">
      <thead class="table-light">
        <tr>
          <th>Código</th>
          <th>Alumno</th>
          <th>Curso</th>
          <th>Sección</th>
          <th>Av1</th>
          <th>Av2</th>
          <th>Av3</th>
          <th>Part.</th>
          <th>Proyecto</th>
          <th>Final</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let n of filas">
          <td>{{ n.codigo }}</td>
          <td>{{ n.alumno }}</td>
          <td>{{ n.curso }}</td>
          <td>{{ n.seccion }}</td>
          <td>{{ n.av1 }}</td>
          <td>{{ n.av2 }}</td>
          <td>{{ n.av3 }}</td>
          <td>{{ n.part }}</td>
          <td>{{ n.proy }}</td>
          <td>{{ n.final }}</td>
        </tr>
      </tbody>
    </table>
  </div>
  <ng-template #noRows>
    <div class="text-muted">Sin datos. Usa los filtros y presiona “Filtrar”.</div>
  </ng-template>
</div>
